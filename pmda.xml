<?xml version="1.0"?>
<Container version="2">
  <Name>PMDA</Name>
  <Repository>meaning/pmda:latest</Repository>
  <Registry>https://hub.docker.com/r/meaning/pmda</Registry>
  <Network>bridge</Network>
  <Shell>sh</Shell>
  <Privileged>false</Privileged>

  <Support>https://github.com/silkyclouds/PMDA/issues</Support>
  <Project>https://github.com/silkyclouds/PMDA</Project>
  <Overview>
    PMDA – Plex Music DeDupe Assistant.  
    Detect and clean duplicate albums in your Plex music library (optional AI assistance).
  </Overview>
  <Category>MediaApp:Music</Category>

  <!-- The CA UI button -->
  <WebUI>http://[IP]:[PORT:5005]</WebUI>

  <Icon>https://raw.githubusercontent.com/silkyclouds/PMDA/main/static/P.png</Icon>

  <!-- ────────────────────────  ENV-VARS  ───────────────────────── -->

  <!-- Plex basics -->
  <Config Name="Plex Host URL"
          Target="PLEX_HOST"
          Default="http://192.168.3.2:32400"
          Description="Base URL of your Plex server, including port."
          Type="Variable" Display="always" Required="true" />

  <Config Name="Plex Token"
          Target="PLEX_TOKEN"
          Default=""
          Description="Your Plex API token (X-Plex-Token)."
          Type="Variable" Display="always" Required="true" Mask="true" />

  <Config Name="Music Section ID"
          Target="SECTION_ID"
          Default="1"
          Description="Numeric ID of your Plex *Music* library section."
          Type="Variable" Display="always" Required="true" />

  <!-- Run-mode -->
  <Config Name="Default Mode"
          Target="PMDA_DEFAULT_MODE"
          Default="serve"
          Description="'serve' → Web UI  'cli' → command-line scan only."
          Type="Variable" Display="always" Required="true" />

  <!-- Path-map used for container→host translation -->
  <Config Name="Path Map"
          Target="PATH_MAP"
          Default="{&quot;/music&quot;:&quot;/path/to/music&quot;}"
          Description="JSON that maps each Plex-container path to the matching PMDA path."
          Type="Variable" Display="always" Required="true" />

  <!-- Optional AI -->
  <Config Name="OpenAI Model"
          Target="OPENAI_MODEL"
          Default="gpt-4o-nano"
          Description="LLM model used for intelligent duplicate selection."
          Type="Variable" Display="always" Required="false" />

  <Config Name="OpenAI API Key"
          Target="OPENAI_API_KEY"
          Default=""
          Description="Provide to enable AI assistance; leave blank to disable."
          Type="Variable" Display="always" Required="false" Mask="true" />

  <!-- Logging / performance tweaks -->
  <Config Name="Log Level"
          Target="LOG_LEVEL"
          Default="INFO"
          Description="DEBUG, INFO, WARNING or ERROR."
          Type="Variable" Display="advanced" Required="false" />

  <Config Name="Scan Threads"
          Target="SCAN_THREADS"
          Default="8"
          Description="Number of parallel scanning threads."
          Type="Variable" Display="advanced" Required="false" />

  <!-- ────────────────────────  VOLUMES  ─────────────────────────── -->

  <Config Name="Config Directory"
          Target="/app/config"
          Default="/path/to/appdata/pmda"
          Mode="rw"
          Description="Holds config.json, state.db and cache.db."
          Type="Path" Display="always" Required="true" />

  <Config Name="Plex DB Folder"
          Target="/database"
          Default="/path/to/plex/Plug-in Support/Databases"
          Mode="ro"
          Description="Mount your Plex *Databases* folder read-only."
          Type="Path" Display="always" Required="true" />

  <Config Name="Music Folder 1"
          Target="/music"
          Default="/path/to/music"
          Mode="rw"
          Description="First music library path."
          Type="Path" Display="always" Required="true" />

  <Config Name="Music Folder 2"
          Target="/music2"
          Default="/path/to/music2"
          Mode="rw"
          Description="(Optional) Second music library path."
          Type="Path" Display="always" Required="false" />

  <Config Name="Music Folder 3"
          Target="/music3"
          Default="/path/to/music3"
          Mode="rw"
          Description="(Optional) Third music library path."
          Type="Path" Display="always" Required="false" />

  <Config Name="Dupe Output Folder"
          Target="/dupes"
          Default="/path/to/music/dupes"
          Mode="rw"
          Description="Where PMDA will move the loser folders."
          Type="Path" Display="always" Required="true" />

  <!-- ────────────────────────  PORT  ────────────────────────────── -->

  <!-- Container always listens on 5005; user chooses host-port -->
  <Config Name="WebUI Port"
          Target="5005"                <!-- container-port -->
          Default="5005"               <!-- host-port default -->
          Mode="tcp"
          Description="Map any HOST port → container 5005 (Web UI)."
          Type="Port" Display="always" Required="true" />
</Container>
